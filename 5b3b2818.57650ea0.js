(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{122:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return r})),a.d(t,"default",(function(){return l}));var n=a(2),i=a(6),s=(a(0),a(218)),o={title:"Designated timestamp",sidebar_label:"Designated timestamp",description:"How designated timestamps are implemented and why it is an important functionality for time-series."},c={unversionedId:"concept/designated-timestamp",id:"concept/designated-timestamp",isDocsHomePage:!1,title:"Designated timestamp",description:"How designated timestamps are implemented and why it is an important functionality for time-series.",source:"@site/docs/concept/designated-timestamp.md",slug:"/concept/designated-timestamp",permalink:"/docs/concept/designated-timestamp",version:"current",sidebar_label:"Designated timestamp",sidebar:"docs",previous:{title:"Storage model",permalink:"/docs/concept/storage-model"},next:{title:"SQL extensions",permalink:"/docs/concept/sql-extensions"}},r=[{value:"Properties",id:"properties",children:[]},{value:"Out-of-order policy",id:"out-of-order-policy",children:[]},{value:"Advantages",id:"advantages",children:[]},{value:"Examples",id:"examples",children:[]},{value:"Working with timestamp order constraint",id:"working-with-timestamp-order-constraint",children:[]}],m={rightToc:r};function l(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(s.b)("wrapper",Object(n.a)({},m,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"QuestDB offers the option to elect a column as ",Object(s.b)("inlineCode",{parentName:"p"},"designated timestamp"),". This\nallows you to leverage the high-performance time series functions of QuestDB,\nbut introduces a constraint on the column in question that will reject\nout-of-order inserts."),Object(s.b)("h2",{id:"properties"},"Properties"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Only a ",Object(s.b)("inlineCode",{parentName:"li"},"timestamp")," column can be ",Object(s.b)("inlineCode",{parentName:"li"},"designated timestamp"),"."),Object(s.b)("li",{parentName:"ul"},"Only ",Object(s.b)("inlineCode",{parentName:"li"},"one")," column can be elected for a given table."),Object(s.b)("li",{parentName:"ul"},Object(s.b)("inlineCode",{parentName:"li"},"designated timestamp")," can be elected either:",Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},"during table creation."),Object(s.b)("li",{parentName:"ul"},"on the fly on sub-tables created within a query.")))),Object(s.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(s.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(s.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(s.b)("p",{parentName:"div"},"To elect a timestamp column on the fly, please refer to the\n",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/reference/function/timestamp/"}),"dynamic timestamp")," documentation."))),Object(s.b)("h2",{id:"out-of-order-policy"},"Out-of-order policy"),Object(s.b)("p",null,"Once a column is elected as ",Object(s.b)("inlineCode",{parentName:"p"},"designated timestamp"),", it will enforce an order\npolicy on this column. Inserts in ",Object(s.b)("inlineCode",{parentName:"p"},"designated timestamp")," need to be incrementing\nand out-of-order timestamps inserts will be rejected. This does not affect the\nbehaviour of other columns."),Object(s.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(s.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(s.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(s.b)("p",{parentName:"div"},"New timestamps need to be ",Object(s.b)("inlineCode",{parentName:"p"},"greater or equal")," to the latest timestamp in the\ncolumn."))),Object(s.b)("h2",{id:"advantages"},"Advantages"),Object(s.b)("p",null,"Electing a ",Object(s.b)("inlineCode",{parentName:"p"},"designated timestamp")," allows you to:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"leverage timestamp partitions. For more information, refer to the\n",Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/concept/partitions/"}),"partitions section"),"."),Object(s.b)("li",{parentName:"ul"},"use time series joins such as ",Object(s.b)("inlineCode",{parentName:"li"},"ASOF JOIN"),". For more information refer to the\n",Object(s.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/reference/sql/join/"}),"JOIN reference"),".")),Object(s.b)("h2",{id:"examples"},"Examples"),Object(s.b)("p",null,"Representation of ",Object(s.b)("inlineCode",{parentName:"p"},"designated timestamp")," as a special column alongside other\nexisting timestamp columns. Note that:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"the ",Object(s.b)("inlineCode",{parentName:"li"},"designated timestamp")," column only allows ordered timestamps"),Object(s.b)("li",{parentName:"ul"},"any other ",Object(s.b)("inlineCode",{parentName:"li"},"timestamp")," column tolerates out-of-order timestamps")),Object(s.b)("img",{alt:"Comparison between a designated timestamp and a normal timestamp",className:"screenshot--shadow screenshot--docs",src:"/img/docs/concepts/designatedTimestamp.svg"}),Object(s.b)("p",null,"Attempts to insert ",Object(s.b)("inlineCode",{parentName:"p"},"out-of-order")," timestamps will be rejected:"),Object(s.b)("img",{alt:"Diagram of an out of order insertion being rejected",className:"screenshot--shadow screenshot--docs",src:"/img/docs/concepts/timestampReject.svg"}),Object(s.b)("h2",{id:"working-with-timestamp-order-constraint"},"Working with timestamp order constraint"),Object(s.b)("p",null,"The constraint provides many benefits for both insert and query speed. However,\nit may be impractical in certain cases, for example when inserting values from\nmultiple devices with slightly different clocks or network conditions. Luckily,\nthere are ways to circumvent this with little overhead."),Object(s.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(s.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(s.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(s.b)("p",{parentName:"div"},"This is a temporary workaround. We are working on a table implementation which\nsupports out-of-order insertion."))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Use the ",Object(s.b)("inlineCode",{parentName:"li"},"database host clock")," as ",Object(s.b)("inlineCode",{parentName:"li"},"designated timestamp")," by using\n",Object(s.b)("inlineCode",{parentName:"li"},"systimestamp()"),":")),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-questdb-sql",metastring:'title=""',title:'""'}),"CREATE TABLE readings(\n    db_ts timestamp,\n    device_ts timestamp,\n    device_name symbol,\n    reading int)\ntimestamp(db_ts);\n")),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-questdb-sql"}),"INSERT INTO readings VALUES(\nsystimestamp(),\nto_timestamp('2020-03-01:15:43:21', 'yyyy-MM-dd:HH:mm:ss'),\n'ig-1579JS09H',\n133\n);\n")),Object(s.b)("div",{className:"admonition admonition-info alert alert--info"},Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(s.b)("h5",{parentName:"div"},Object(s.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(s.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(s.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(s.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(s.b)("p",{parentName:"div"},"For more information about ",Object(s.b)("inlineCode",{parentName:"p"},"systimestamp()")," and related functions, check the\n",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/reference/function/date-time/"}),"date & time functions section"),"."))),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Use a temporary table for the latest partition. Data can be out-of-order in\nthis table.")),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-questdb-sql",metastring:'title="Main table"',title:'"Main','table"':!0}),"CREATE TABLE readings(\n    db_ts timestamp,\n    device_ts timestamp,\n    device_name symbol,\n    reading int)\n    timestamp(db_ts)\nPARTITION BY DAY;\n")),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-questdb-sql",metastring:'title="Temporary table"',title:'"Temporary','table"':!0}),"CREATE TABLE readings_temp(\n    db_ts timestamp,\n    device_ts timestamp,\n    device_name symbol,\n    reading int);\n")),Object(s.b)("p",null,"When switching over to a new day, order the data in the temporary partition as\nit is inserted into the main table."),Object(s.b)("p",null,"fashion:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-questdb-sql",metastring:'title="Insert ordered data"',title:'"Insert',ordered:!0,'data"':!0}),"INSERT INTO readings\n    SELECT * FROM (readings_temp ORDER BY db_ts) timestamp(db_ts);\n")))}l.isMDXComponent=!0}}]);