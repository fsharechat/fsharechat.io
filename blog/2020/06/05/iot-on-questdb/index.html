<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="fsharechat">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@questdb">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="shortcut icon" href="https://https://fsharechat.github.io//img/favicon.png">
<link rel="apple-touch-icon" sizes="48x48" href="/img/icons/icon-48x48.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="256x256" href="/img/icons/icon-256x256.png">
<link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Time series data, faster Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Time series data, faster Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Time series data, faster" href="/opensearch.xml">
<link rel="icon" href="/img/favicon.png">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="apple-touch-icon" href="/img/favicon.png">
<link rel="mask-icon" href="/img/favicon.png" content="#fff">
<meta name="msapplication-TileImage" content="/img/favicon.png">
<meta name="msapplication-TileColor" content="#21222c"><title data-react-helmet="true">IoT on QuestDB | Time series data, faster</title><meta data-react-helmet="true" name="description" content="Demonstration of an IoT application with QuestDB. This is based on an Arduino device."><meta data-react-helmet="true" property="og:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" property="og:url" content="https://https://fsharechat.github.io/"><meta data-react-helmet="true" property="og:title" content="IoT on QuestDB | Time series data, faster"><meta data-react-helmet="true" property="og:description" content="Demonstration of an IoT application with QuestDB. This is based on an Arduino device."><meta data-react-helmet="true" name="twitter:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" name="twitter:description" content="Demonstration of an IoT application with QuestDB. This is based on an Arduino device."><meta data-react-helmet="true" name="twitter:title" content="IoT on QuestDB | Time series data, faster"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;IoT on QuestDB | Time series data, faster&quot;"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link rel="stylesheet" href="/styles.2a8a7e1b.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Fast SQL open source database for time series - QuestDB">
<meta itemprop="description" content="QuestDB is an open source database designed to make time-series lightning fast and easy. It exposes a high performance REST API and supports Postgres wire.">
<meta itemprop="url" content="https://https://fsharechat.github.io/">
<meta itemprop="logo" content="https://https://fsharechat.github.io//img/favicon.png">
<meta itemprop="sameAs" content="https://twitter.com/questdb">
<meta itemprop="sameAs" content="https://www.linkedin.com/company/questdb/">
<meta itemprop="sameAs" content="https://www.crunchbase.com/organization/quest-db">
<meta itemprop="sameAs" content="https://github.com/questdb">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner inner_3txf"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_9Wyn" href="/"><img alt="QuestDB" class="navbar__logo" src="/img/navbar/fshare.svg"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/guide/docker/">Docker</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/homebrew/">Homebrew</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/binaries/">From the binaries</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/introduction/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__item--github">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button><a class="getStarted_1xnS button_Ni2_ button--primary_316O button--uppercase_35Ce button--xsmall_3jz_" href="/getstarted/">Get Started</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_9Wyn" href="/"><img alt="QuestDB" class="navbar__logo" src="/img/navbar/fshare.svg"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Install</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/docker/">Docker</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/homebrew/">Homebrew</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/binaries/">From the binaries</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/">Documentation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer" class="menu__link navbar__item--github">GitHub</a></li></ul></div></div></div></nav><div class="wrapper_1hNx"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_1mse">IoT on QuestDB</h1><div class="margin-vert--md"><time datetime="2020-06-05T00:00:00.000Z" class="blogPostDate_3bQP">June 5, 2020  · 7 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/davidgs" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/davidgs" alt="David G Simmons"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/davidgs" target="_blank" rel="noreferrer noopener">David G Simmons</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><section class="markdown"><p>As you can well imagine, I&#x27;ve been super busy in my hew job at QuestDB so this
has taken me longer than I would have liked, but here we are. If you know me at
all, you know that one of the first things I always do with new things is, well,
connect things to them! So I immediately went to connect an IoT device to
QuestDB to see how it went. Unsurprisingly, it went quite well. So here&#x27;s how it
went, from start to finish.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-database-part"></a>The Database Part<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-database-part" title="Direct link to heading">#</a></h2><p>The first thing I had to do was a to get QuestDB up and running. Luckily, this
is very straightforward. I guess I could have gone the Docker route, but as
you&#x27;re probably aware, I&#x27;m not a huge fan of Docker (in no small part due to the
fact that it will literally suck the life out of a macOS laptop). There&#x27;s also
(for you macOS users) <code>brew install questdb</code> but since I work here, and I wanted
to test out the latest and greatest Web Console, I decided to build from source:</p><p><img alt="Terminal showing QuestDB being build from its source code" src="/assets/images/build-82ea418e9a1c6799a91d63cc78e62a03.gif"></p><p>It builds really quickly due to the lack of external dependencies, so that is
great! Then all I have to do is start it:</p><p><img alt="Terminal showing how to start QuestDB" src="/assets/images/start-d9a110dcbbee7b1f6a444b519441db1c.gif"></p><p>That is literally all there is to getting QuestDB built and running. But that&#x27;s
just the first part. Now it&#x27;s time to do something mildly useful with it. First,
I&#x27;ll need to create a table in QuestDB to store my IoT Data (A bit more on this
later, so store a pointer to this).</p><p><img alt="Screenshot of a SQL query in the Web Console to create a table" src="/assets/images/console-3b9f2c79cc1e445ab82018d1310a9649.png"></p><p>Remember, we&#x27;re doing SQL here, so it there&#x27;s no new language or syntax to
learn. This is a really simple table that I&#x27;m building because I&#x27;m going to be
using an ESP8266 with a (really awful) DHT11 temperature and humidity sensor on
it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-sensor-part"></a>The Sensor Part<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-sensor-part" title="Direct link to heading">#</a></h2><p>For this I&#x27;m going to use an ESP8266-based WEMOS D1 Mini only because I happen
to have a giant pile of them lying around. I buy them in bulk because they are a
dollar or 2 each, easy to use, and largely disposable if I blow one up (which I
do with alarming regularity.). The circuit is extremely simple to do:</p><p><img alt="Electrical schema showing how the sensor is wired" src="/assets/images/sensor-1ca379b49a8ea16563ae25872f3eb6c1.png"></p><p>I used an actual WEMOS Shield with the DHT11 on it, so I didn&#x27;t have to
breadboard it, but this schematic gives you an idea of how simple the wiring is.
It&#x27;s literally 3 wires.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-code-part"></a>The Code Part<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-code-part" title="Direct link to heading">#</a></h2><p>Here is where the magic happens. How I actually send the sensor data to the
database. There is a simple example program included with the Adafruit DHT
Unified Sensor Library that I recommend starting with in order to make this a
bit easier. It already has all the parts to read from the sensor so you don&#x27;t
have to write those from scratch. Remember: Good developers copy, but great
developers paste!</p><p>Since I&#x27;m using the 8266, and I&#x27;ll need internet connectivity, I&#x27;ll need all the
WiFi bits:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiServerSecure</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiClientSecure</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiClientSecureBearSSL</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFi</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFiMulti</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiUdp</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFiType</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">CertStoreBearSSL</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFiAP</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiClient</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">BearSSLHelpers</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiServer</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFiScan</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiServerSecureBearSSL</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFiGeneric</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">ESP8266WiFiSTA</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiClientSecureAxTLS</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">WiFiServerSecureAxTLS</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span></div></div></div></div></div><p>Really all you have to do is go to the &#x27;Sketch&#x27; Menu, Choose &#x27;Include Library&#x27;
and select the &#x27;ESP8266WiFi&#x27; library and you get all this stuff imported for
you.</p><p>Here&#x27;s some boiler-plate code you can always use to get your ESP8266 on your
WiFi:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics class-name">Adafruit_Sensor</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics">DHT</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#include </span><span class="token generics punctuation" style="color:#f8f8f2">&lt;</span><span class="token generics">DHT_U</span><span class="token generics punctuation" style="color:#f8f8f2">.</span><span class="token generics">h</span><span class="token generics punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#define DHTPIN D4</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// Digital pin connected to the DHT sensor</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#define DHTTYPE DHT11 </span><span class="token comment" style="color:#6272a4">// DHT 11</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#define QUEST_SERVER </span><span class="token string" style="color:#f1fa8c">&quot;10.10.10.10&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">// use your server&#x27;s IP address!</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#define QUEST_PORT </span><span class="token number" style="color:#50fa7b">9009</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#define SENSOR_ID </span><span class="token number" style="color:#50fa7b">4343</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">// I made this up</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">#define SENSOR_NAME </span><span class="token string" style="color:#f1fa8c">&quot;DHT11-WEMOS&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"> ssid </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;your-ssid&quot;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"> password </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;your-password&quot;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token class-name">DHT_Unified</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">dht</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">DHTPIN</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> DHTTYPE</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">uint32_t delayMS</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token class-name">WiFiUDP</span><span class="token plain"> </span><span class="token class-name">Udp</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">void</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">setup</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">begin</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">115200</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">delay</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">10</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// We start by connecting to a WiFi network</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Connecting to &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ssid</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">WiFi</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">begin</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ssid</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">WiFi</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">status</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> WL_CONNECTED</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">delay</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">500</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;.&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;WiFi connected&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;IP address: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">WiFi</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">localIP</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  dht</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">begin</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Udp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">begin</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">QUEST_PORT</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;DHTxx Unified Sensor Example&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Print temperature sensor details.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  sensor_t sensor</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  dht</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">temperature</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">getSensor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;------------------------------------&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Temperature Sensor&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">print </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Sensor Type: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">print </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Driver Ver: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">version</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">print </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Unique ID: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">sensor_id</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">print </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Max Value: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">max_value</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;°C&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">print </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Min Value: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sensor</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">min_value</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;°C&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">print </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Resolution: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p>That gets the basics set up. Running that should get you a WiFi connection and a
fully configured DHT11 sensor. We&#x27;re almost ready to start sending data to the
database</p><p>If you were paying attention, and read the code, you&#x27;ll have noticed the UDP
stuff I snuck in there. That&#x27;s because we&#x27;re going to make this super easy and
use UDP to send our data. And there&#x27;s a <strong>really</strong> good reason for
that: InfluxDB line protocol. You see, QuestDB has a built-in InfluxDB line
Protocol listener, but (for now) it&#x27;s only listening on a UDP port. So we&#x27;re
going to use that.</p><p>Now, to send some data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">void</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">loop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Delay between measurements.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">delay</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">delayMS</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  buffer </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token function" style="color:#8be9fd">malloc</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">256</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Get temperature event and print its value.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">double</span><span class="token plain"> temp </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token number" style="color:#50fa7b">212</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">double</span><span class="token plain"> hum </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  sensors_event_t event</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  dht</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">temperature</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">getEvent</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">isnan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">temperature</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Error reading temperature!&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Temperature: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">temperature</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    temp </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">temperature</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;°C&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Get humidity event and print its value.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  dht</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">humidity</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">getEvent</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">isnan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">relative_humidity</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Error reading humidity!&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;Humidity: &quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">relative_humidity</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    hum </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">relative_humidity</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">F</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;%&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">temp </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token number" style="color:#50fa7b">212</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> hum </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">-</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> tTemp</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">10</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">char</span><span class="token plain"> hTemp</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">10</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">dtostrf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">temp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">4</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> tTemp</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">dtostrf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">hum</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">4</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> hTemp</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#8be9fd">sprintf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;iot,dev_id=%d,dev_name=%s temp_c=%s,humidity=%s&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> SENSOR_ID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> SENSOR_NAME</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> tTemp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> hTemp</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Serial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Udp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">beginPacket</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">QUEST_SERVER</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> QUEST_PORT</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Udp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">write</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">Udp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">endPacket</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">free</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p>Yeah, there&#x27;s a lot going on in there. So let&#x27;s break it down. First, I&#x27;m
creating a buffer to hold the data I&#x27;m going to send, and then I&#x27;ll do a read of
the sensor. I set the <code>temp</code> and <code>hum</code> variables to values that I know the
sensor will never return so that I can check that I got valid readings later, to
avoid sending gibberish to the database.</p><p>I have to do some shenanigans with the temperature and humidity values in there
because one of the shortcomings of Arduinos is that they don&#x27;t have <code>sprintf</code>
support for doubles. I know. So I simply turn them into strings and move on.
Once they arrive at the database, they are interpreted as doubles and life is
good. Not worth fighting about. I can then construct a buffer with straight line
protocol and ship it off to QuestDB over UDP.</p><p>Don&#x27;t forget to free the memory!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="that-pointer"></a>That Pointer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#that-pointer" title="Direct link to heading">#</a></h2><p>Remember I told you to set a pointer earlier about creating the database? Well,
here&#x27;s where I come back to that. You don&#x27;t <em>actually</em> have to create the
database ahead of time <em>unless</em> you want to do things like set indexes,
etc. If all you want to do is have straight values in there, then guess what?
Schema-on-write is a thing here. You can just start writing data to the
database, and it will happily store them for you. Pretty cool stuff.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="querying-the-data"></a>Querying the Data<a aria-hidden="true" tabindex="-1" class="hash-link" href="#querying-the-data" title="Direct link to heading">#</a></h2><p>Using the QuestDB Console, you can then query the data to make sure you&#x27;re
getting what you expect:</p><p><img alt="Running a SELECT query on the Web Console. The result is in both a table and a chart" src="/assets/images/queries-698b6f4cae26b1fd444dc992d2959eee.gif"></p><p>That&#x27;s exactly what I expected!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="whats-next"></a>What&#x27;s Next<a aria-hidden="true" tabindex="-1" class="hash-link" href="#whats-next" title="Direct link to heading">#</a></h2><p>Now it&#x27;s time to start building some dashboards, etc. on top of this. I&#x27;m
currently working on connecting this all up with Node Red, so that may be my
next post. We&#x27;re also working on support for Grafana, which will be huge, so
stay tuned for that. If you like what you see here, pleases go give us a star on
<a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer">GitHub</a>, and follow the project if you&#x27;d like to get updates!</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/iot">iot</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/06/15/python-questdb-tutorial"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Querying data in a Jupyter Notebook</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/05/12/interesting-things-we-learned-about-sums"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Things we learned about sums »</div></a></div></nav></div></div><div class="col col--2"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-database-part" class="table-of-contents__link">The Database Part</a></li><li><a href="#the-sensor-part" class="table-of-contents__link">The Sensor Part</a></li><li><a href="#the-code-part" class="table-of-contents__link">The Code Part</a></li><li><a href="#that-pointer" class="table-of-contents__link">That Pointer</a></li><li><a href="#querying-the-data" class="table-of-contents__link">Querying the Data</a></li><li><a href="#whats-next" class="table-of-contents__link">What&#39;s Next</a></li></ul></div></div></div></div></div><footer class="footer_mib0 section_3Kiu"><div class="footer__inner_z0Le section--inner_2xOo"><div class="footer__column_3Npq footer__column--left_1EuR"><img alt="QuestDB logo" class="footer__logo_29Wo" src="/img/footer/questdb.svg" title="QuestDB - Fastest open source database for time series and analytics"><p class="footer__tagline_2F15">QuestDB is the fastest open source time series database</p><a class="footer__github_8UHO button_Ni2_ button--icon_3YKU button--secondary_1x2U button--xsmall_3jz_" href="https://github.com/questdb/questdb" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_3Npq footer__column--right_1XPX"><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">QuestDB</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/docs/introduction/">Documentation</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/questdb/questdb/projects/3" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/careers/">Careers</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">Community</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://slack.https://fsharechat.github.io/" rel="noopener noreferrer" target="_blank">Slack</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://twitter.com/questdb" rel="noopener noreferrer" target="_blank">Twitter</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">More</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/blog/">Blog</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/questdb/questdb" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></div></div></div><div class="footer__bottom_2RpL"><p class="footer__copyright_1o2i">Copyright © 2020 QuestDB</p></div></footer></div>
<script src="/styles.c1a63971.js" defer="defer"></script>
<script src="/main.6f3bf291.js" defer="defer"></script>
<script src="/common.3d2125a2.js" defer="defer"></script>
<script src="/ccc49370.e8c9b56c.js" defer="defer"></script>
<script src="/dfb4e8b0.5f34bbc6.js" defer="defer"></script>
</body>
</html>