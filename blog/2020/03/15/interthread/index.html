<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="fsharechat">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@questdb">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="shortcut icon" href="https://https://fsharechat.github.io//img/favicon.png">
<link rel="apple-touch-icon" sizes="48x48" href="/img/icons/icon-48x48.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="256x256" href="/img/icons/icon-256x256.png">
<link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Time series data, faster Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Time series data, faster Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Time series data, faster" href="/opensearch.xml">
<link rel="icon" href="/img/favicon.png">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="apple-touch-icon" href="/img/favicon.png">
<link rel="mask-icon" href="/img/favicon.png" content="#fff">
<meta name="msapplication-TileImage" content="/img/favicon.png">
<meta name="msapplication-TileColor" content="#21222c"><title data-react-helmet="true">The art of thread messaging | Time series data, faster</title><meta data-react-helmet="true" name="description" content="Detailed explanation of QuestDB&#x27;s thread messaging system. A benchmark also shows the capabilities of this system."><meta data-react-helmet="true" property="og:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" property="og:url" content="https://https://fsharechat.github.io/"><meta data-react-helmet="true" property="og:title" content="The art of thread messaging | Time series data, faster"><meta data-react-helmet="true" property="og:description" content="Detailed explanation of QuestDB&#x27;s thread messaging system. A benchmark also shows the capabilities of this system."><meta data-react-helmet="true" name="twitter:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" name="twitter:description" content="Detailed explanation of QuestDB&#x27;s thread messaging system. A benchmark also shows the capabilities of this system."><meta data-react-helmet="true" name="twitter:title" content="The art of thread messaging | Time series data, faster"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;The art of thread messaging | Time series data, faster&quot;"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link rel="stylesheet" href="/styles.2a8a7e1b.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Fast SQL open source database for time series - QuestDB">
<meta itemprop="description" content="QuestDB is an open source database designed to make time-series lightning fast and easy. It exposes a high performance REST API and supports Postgres wire.">
<meta itemprop="url" content="https://https://fsharechat.github.io/">
<meta itemprop="logo" content="https://https://fsharechat.github.io//img/favicon.png">
<meta itemprop="sameAs" content="https://twitter.com/questdb">
<meta itemprop="sameAs" content="https://www.linkedin.com/company/questdb/">
<meta itemprop="sameAs" content="https://www.crunchbase.com/organization/quest-db">
<meta itemprop="sameAs" content="https://github.com/questdb">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner inner_3txf"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_9Wyn" href="/"><img alt="QuestDB" class="navbar__logo" src="/img/navbar/fshare.svg"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/guide/docker/">Docker</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/homebrew/">Homebrew</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/binaries/">From the binaries</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/introduction/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__item--github">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button><a class="getStarted_1xnS button_Ni2_ button--primary_316O button--uppercase_35Ce button--xsmall_3jz_" href="/getstarted/">Get Started</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_9Wyn" href="/"><img alt="QuestDB" class="navbar__logo" src="/img/navbar/fshare.svg"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Install</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/docker/">Docker</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/homebrew/">Homebrew</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/binaries/">From the binaries</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/">Documentation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer" class="menu__link navbar__item--github">GitHub</a></li></ul></div></div></div></nav><div class="wrapper_1hNx"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_1mse">The art of thread messaging</h1><div class="margin-vert--md"><time datetime="2020-03-15T00:00:00.000Z" class="blogPostDate_3bQP">March 15, 2020  · 7 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/bluestreak01" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/bluestreak01" alt="Vlad Ilyushchenko"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/bluestreak01" target="_blank" rel="noreferrer noopener">Vlad Ilyushchenko</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><section class="markdown"><img alt="Flock of birds flying in a harmonised way" class="banner" src="/img/blog/2020-03-15/header.png"><p>Inter-thread messaging is a fundamental part of any asynchronous system. It is
the component responsible for transportation of data between threads. Messaging
forms the infrastructure, the scaffolding of multi-threaded application and just
like real-world transport infrastructure we want it to be inexpensive, fast,
reliable and clean.</p><p>For QuestDB we wrote our own messaging system and this post is about how it
works and how fast it is.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="architecture"></a>Architecture<a aria-hidden="true" tabindex="-1" class="hash-link" href="#architecture" title="Direct link to heading">#</a></h2><p>Borrowing heavily from world-famous Disruptor our messaging revolves around
multiple threads accessing shared circular data structure. We call it RingQueue.
Semantically RingQueue provides unbounded, index-based, random access to its
elements. It does not coordinate concurrent access nor does it provide
guarantees on thread safety. Coordination and thread-safety is a concern of
Sequences. Sequences are responsible for providing indices that can be used to
access RingQueue concurrently and safely.</p><p>To help sequences do their magic they have to be shaped into a graph. We start
with syntax to chain sequences together:</p><p><code>a.then(b).then(c).then(d)</code></p><p>The result is a trivial sequence graph:</p><p><code>a -&gt; b -&gt; c -&gt; d</code></p><p>To branch we use helper class FanOut:</p><p><code>a.then(FanOut.to(b).and(c)).then(d)</code></p><p>The result is this sequence graph:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">     +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> B --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">A --</span><span class="token operator" style="color:#ff79c6">&gt;|</span><span class="token plain">         </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> D</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">     +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> C --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div></div></div></div></div><p>These two pieces of syntax are flexible enough to create any desired flow. This
example shows that FanOut can have chain of sequences and other FanOuts:</p><p><code>a.then(FanOut.to(FanOut.to(b).and(c)).and(d.then(e)).then(f)</code></p><p>It is quite a mouthful but it creates this nice little graph:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">        +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> B --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    +-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">         </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">   +--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> C --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">A--</span><span class="token operator" style="color:#ff79c6">&gt;|</span><span class="token plain">             </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">--</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> F</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain">             </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    +-</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> D -</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> E --</span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain">+</span></div></div></div></div></div><p>FanOut can also be used as a placeholder in a chain to allow threads to
subscribe/unsubscribe on the fly. Dynamic subscription is then simply adding a
new sequence to FanOut:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">// You can add as many sequences into fan out as you like.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// Sequences can be added either up front or subscribe/unsubscribe on the fly.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token class-name">FanOut</span><span class="token plain"> fanOut </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">new</span><span class="token plain"> </span><span class="token class-name">FanOut</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// ordinary producer sequence</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token class-name">Sequence</span><span class="token plain"> seqProducer </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">new</span><span class="token plain"> </span><span class="token class-name">SPSequence</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">queue</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">getCapacity</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// daisy chain producer and fan out and loop back producer</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">seqProducer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">then</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">fanOut</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">then</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">seqProducer</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// meanwhile in another thread ....</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// Add individual consumer sequences later as needed.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// This is thread safe non-blocking operation that can be performed from any thread.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// It is important to use current producer position as consumer starting point when subscribing on the fly.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token class-name">Sequence</span><span class="token plain"> consumer1 </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> fanOut</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">addAndGet</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">new</span><span class="token plain"> </span><span class="token class-name">SCSequence</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">seqProducer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">current</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// do something useful with consumer1 sequence</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// remove sequence from fanOut to unsubscribe</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">fanOut</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">remove</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">consumer1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div></div></div><p>Typical graph must contain single producer sequence and one or more consumer
sequences. It will also have to be circular, e.g. to start and end with producer
sequence. Graph has to be circular because we use circular underlying data
structure, RingQueue. Without loop-back producer would be liable to overwrite
queue elements before consumers had a chance to read them. Worse still, queue
elements can be written to and read from concurrently. We don&#x27;t want that to
happen, right?</p><p>To help create practical sequence graph we implemented 4 types of sequences we
can play with. These sequences are better understood as combination of their
types and properties. SP - single producer, MP - multiple producer, SC - single
consumer and MC - multiple consumer. Multi- sequences allow concurrent access
and they guarantee that no two threads can retrieve same index. It is this
property adds extra fun dimension to sequence graphs. Consider this graph:</p><p><code>A -&gt; B -&gt; A</code></p><p>or in Java notations:</p><p><code>A.then(B).then(A)</code></p><p>When &quot;B&quot; is an instance of MCSequence() we have a self-balancing worker pool.
When &quot;A&quot; is MPSequence(), we have many-to-many pub-sub system. Cool, eh?</p><p>Single- sequences are faster but they are not thread-safe. They should be
preferred for single-threaded consumer models.</p><p>Lets take a look at how threads interact with sequences. This is a typical
example of publisher:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">// loop until there is work to do</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// consumer thread may be able to rely on producer to</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// publish &quot;special&quot; message to indicate end of stream.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token boolean" style="color:#bd93f9">true</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Non-blocking call. Method returns immediately either with zero-based</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// ring queue index or negative long indicating one of following:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// -1 = queue is empty</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// -2 = there was a contest for queue index and this thread has lost</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">long</span><span class="token plain"> cursor </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cursor </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// negative cursor is an error</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// thread has a choice of things to do:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// - busy spin</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// - yield/park</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// - work on something else</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">LockSupport</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">parkNanos</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">continue</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// write to queue</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    queue</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// releasing cursor promptly is important</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    sequence</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">done</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p><code>Sequence.next()</code> return values are:</p><p>-1 Queue is unavailable. It is either full or empty, depending on whether it is
producer or consumer sequence</p><p>-2 Temporary race condition. Sequence failed CAS and delegated decision to your
application.</p><p>Consumer sequence interaction is almost identical. The only difference would be
consumer reading queue item instead of writing it.</p><p>Performance of single-threaded sequences can benefit further from batching.
Batching relies on receiving range of indices from sequence and calling done()
at end of batch rather than for every queue item. This is what consumer code
might look like (producer code is the same):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">running</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">long</span><span class="token plain"> cursor </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cursor </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token class-name">LockSupport</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">parkNanos</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">continue</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// get max index sequence can reach</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">long</span><span class="token plain"> available </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">available</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// look thru queue elements without using sequence</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cursor </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> available</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    queue</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cursor</span><span class="token operator" style="color:#ff79c6">++</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// calling done() only once per batch can yield significant performance benefit</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  sequence</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">done</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">available </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p>Multi-threaded sequence do not support batches.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="performance"></a>Performance<a aria-hidden="true" tabindex="-1" class="hash-link" href="#performance" title="Direct link to heading">#</a></h2><p>I used Shipilev&#x27;s project that already had Disruptor benchmark and I added
QuestDB implementation of the same pipeline.</p><p>Benchmark source on <a href="https://github.com/bluestreak01/disrupting-fjp" target="_blank" rel="noopener noreferrer">GitHub</a></p><p><strong>2 CPU MBP 2015</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Benchmark          </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">slicesK</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">threads</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">workMult</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  Mode  Cnt    Score    Error  Units</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run            </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">10.043</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.158</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">19.944</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.285</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">133.082</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">6.032</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">13.027</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.180</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">26.329</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.327</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">141.686</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">4.129</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">29.470</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.976</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">62.205</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">3.278</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">2</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">321.697</span><span class="token plain"> ± </span><span class="token number" style="color:#50fa7b">12.031</span><span class="token plain">  ms/op</span></div></div></div></div></div><p><strong>4 CPU x5960 @ 4.2Ghz</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">Benchmark          </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">slicesK</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">threads</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">workMult</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain">  Mode  Cnt    Score    Error  Units</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run            </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">    </span><span class="token number" style="color:#50fa7b">6.892</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.654</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">10.143</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.623</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Disruptor.run           </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">54.084</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">4.164</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">    </span><span class="token number" style="color:#50fa7b">6.364</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.197</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">11.454</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">0.754</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbFanOut.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">50.928</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">3.264</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run        </span><span class="token number" style="color:#50fa7b">500</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">14.240</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">1.341</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">1000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">   </span><span class="token number" style="color:#50fa7b">27.246</span><span class="token plain"> ±  </span><span class="token number" style="color:#50fa7b">2.777</span><span class="token plain">  ms/op</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">QuestdbWorker.run       </span><span class="token number" style="color:#50fa7b">5000</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">4</span><span class="token plain">          </span><span class="token number" style="color:#50fa7b">10</span><span class="token plain">    ss   </span><span class="token number" style="color:#50fa7b">50</span><span class="token plain">  </span><span class="token number" style="color:#50fa7b">142.207</span><span class="token plain"> ± </span><span class="token number" style="color:#50fa7b">15.157</span><span class="token plain">  ms/op</span></div></div></div></div></div><p>Disruptor and QuestDB perform essentially the same.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="how-to-get-it"></a>How to get it<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-get-it" title="Direct link to heading">#</a></h2><p>Our messaging system is on Maven central as a part of QuestDB. Don&#x27;t worry about
package size though, QuestDB jar is around 3.6MB and has no dependencies. Jump
to the <a href="https://github.com/questdb/questdb/releases" target="_blank" rel="noopener noreferrer">GitHub release page</a> for version reference.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/deep-dive">deep-dive</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/04/02/using-simd-to-aggregate-billions-of-rows-per-second"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Aggregating billions of rows per sec with SIMD</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2019/12/19/lineprot"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Speeding up InfluxDB line protocol »</div></a></div></nav></div></div><div class="col col--2"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture" class="table-of-contents__link">Architecture</a></li><li><a href="#performance" class="table-of-contents__link">Performance</a></li><li><a href="#how-to-get-it" class="table-of-contents__link">How to get it</a></li></ul></div></div></div></div></div><footer class="footer_mib0 section_3Kiu"><div class="footer__inner_z0Le section--inner_2xOo"><div class="footer__column_3Npq footer__column--left_1EuR"><img alt="QuestDB logo" class="footer__logo_29Wo" src="/img/footer/questdb.svg" title="QuestDB - Fastest open source database for time series and analytics"><p class="footer__tagline_2F15">QuestDB is the fastest open source time series database</p><a class="footer__github_8UHO button_Ni2_ button--icon_3YKU button--secondary_1x2U button--xsmall_3jz_" href="https://github.com/questdb/questdb" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_3Npq footer__column--right_1XPX"><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">QuestDB</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/docs/introduction/">Documentation</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/questdb/questdb/projects/3" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/careers/">Careers</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">Community</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://slack.https://fsharechat.github.io/" rel="noopener noreferrer" target="_blank">Slack</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://twitter.com/questdb" rel="noopener noreferrer" target="_blank">Twitter</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">More</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/blog/">Blog</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/questdb/questdb" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></div></div></div><div class="footer__bottom_2RpL"><p class="footer__copyright_1o2i">Copyright © 2020 QuestDB</p></div></footer></div>
<script src="/styles.c1a63971.js" defer="defer"></script>
<script src="/main.6f3bf291.js" defer="defer"></script>
<script src="/common.3d2125a2.js" defer="defer"></script>
<script src="/ccc49370.e8c9b56c.js" defer="defer"></script>
<script src="/406c661b.f32f8bdb.js" defer="defer"></script>
</body>
</html>