<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="fsharechat">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@questdb">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="shortcut icon" href="https://https://fsharechat.github.io//img/favicon.png">
<link rel="apple-touch-icon" sizes="48x48" href="/img/icons/icon-48x48.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="256x256" href="/img/icons/icon-256x256.png">
<link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Time series data, faster Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Time series data, faster Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-PVR7M2G",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Time series data, faster" href="/opensearch.xml">
<link rel="icon" href="/img/favicon.png">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="apple-touch-icon" href="/img/favicon.png">
<link rel="mask-icon" href="/img/favicon.png" content="#fff">
<meta name="msapplication-TileImage" content="/img/favicon.png">
<meta name="msapplication-TileColor" content="#21222c"><title data-react-helmet="true">My journey making QuestDB | Time series data, faster</title><meta data-react-helmet="true" name="description" content="The detailed story of how the open source time series database QuestDB came to life."><meta data-react-helmet="true" property="og:url" content="https://https://fsharechat.github.io/"><meta data-react-helmet="true" property="og:title" content="My journey making QuestDB | Time series data, faster"><meta data-react-helmet="true" property="og:description" content="The detailed story of how the open source time series database QuestDB came to life."><meta data-react-helmet="true" name="twitter:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" name="twitter:description" content="The detailed story of how the open source time series database QuestDB came to life."><meta data-react-helmet="true" name="twitter:title" content="My journey making QuestDB | Time series data, faster"><meta data-react-helmet="true" property="og:image" content="https://https://fsharechat.github.io//img/blog/2020-08-06/foggy-path.jpg"><meta data-react-helmet="true" property="twitter:image" content="https://https://fsharechat.github.io//img/blog/2020-08-06/foggy-path.jpg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for My journey making QuestDB"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link rel="stylesheet" href="/styles.2a8a7e1b.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="Fast SQL open source database for time series - QuestDB">
<meta itemprop="description" content="QuestDB is an open source database designed to make time-series lightning fast and easy. It exposes a high performance REST API and supports Postgres wire.">
<meta itemprop="url" content="https://https://fsharechat.github.io/">
<meta itemprop="logo" content="https://https://fsharechat.github.io//img/favicon.png">
<meta itemprop="sameAs" content="https://twitter.com/questdb">
<meta itemprop="sameAs" content="https://www.linkedin.com/company/questdb/">
<meta itemprop="sameAs" content="https://www.crunchbase.com/organization/quest-db">
<meta itemprop="sameAs" content="https://github.com/questdb">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner inner_3txf"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_9Wyn" href="/"><img alt="QuestDB" class="navbar__logo" src="/img/navbar/fshare.svg"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Install</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/guide/docker/">Docker</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/homebrew/">Homebrew</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/binaries/">From the binaries</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/introduction/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__item--github">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button><a class="getStarted_1xnS button_Ni2_ button--primary_316O button--uppercase_35Ce button--xsmall_3jz_" href="/getstarted/">Get Started</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_9Wyn" href="/"><img alt="QuestDB" class="navbar__logo" src="/img/navbar/fshare.svg"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Install</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/docker/">Docker</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/homebrew/">Homebrew</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/binaries/">From the binaries</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/">Documentation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/questdb/questdb" target="_blank" rel="noopener noreferrer" class="menu__link navbar__item--github">GitHub</a></li></ul></div></div></div></nav><div class="wrapper_1hNx"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_1mse">My journey making QuestDB</h1><div class="margin-vert--md"><time datetime="2020-08-06T00:00:00.000Z" class="blogPostDate_3bQP">August 6, 2020  · 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/bluestreak01" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/bluestreak01" alt="Vlad Ilyushchenko"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/bluestreak01" target="_blank" rel="noreferrer noopener">Vlad Ilyushchenko</a></h4><small class="avatar__subtitle">QuestDB Team</small></div></div></header><section class="markdown"><p>A few weeks ago, I posted
<a href="https://news.ycombinator.com/item?id=23975807" target="_blank" rel="noopener noreferrer">the story of how I started QuestDB on Hacker News</a>.
As it seems several people found the story interesting, I thought I would post
it here.</p><img class="banner" alt="A path going into the morning mist" src="/img/blog/2020-08-06/foggyPath.jpg"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-setup"></a>The setup<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-setup" title="Direct link to heading">#</a></h2><p>It started in 2012 when an energy trading company hired me to rebuild their
real-time vessel tracking system. Management wanted me to use a well-known XML
database that they had just bought a license for. This option would have
required to take down production for about a week just to ingest the data. And a
week downtime was not an option. With no more money to spend on software, I
turned to alternatives such as OpenTSDB but they were not a fit for our data
model. There was no solution in sight to deliver the project.</p><p>Then, I stumbled upon
<a href="https://github.com/peter-lawrey/Java-Chronicle" target="_blank" rel="noopener noreferrer">Peter Lawrey’s Java Chronicle library</a>.
It loaded the same data in 2 minutes instead of a week using memory-mapped
files. Besides the performance aspect, I found it fascinating that such a simple
method was solving multiple issues simultaneously: fast write, read can happen
even before data is committed to disk, code interacts with memory rather than IO
functions, no buffers to copy. Incidentally, this was my first exposure to
zero-GC Java.</p><p>But there were several issues. First, at the time It didn’t look like the
library was going to be maintained. Second, it used Java NIO instead of using
the OS API directly. This adds overhead since it creates individual objects with
sole purpose to hold a memory address for each memory page. Third, although the
NIO allocation API was well documented, the release API was not. It was really
easy to run out of memory and hard to manage memory page release. I decided to
ditch the XML DB and then started to write a custom storage engine in Java,
similar to what Java Chronicle did. This engine used memory mapped files,
off-heap memory and a custom query system for geospatial time series.
Implementing this was a refreshing experience. I learned more in a few weeks
than in years on the job.</p><p>Throughout my career, I mostly worked at large companies where developers are
“managed” via itemized tasks sent as tickets. There was no room for creativity
or initiative. In fact, it was in one’s best interest to follow the ticket&#x27;s
exact instructions, even if it was complete nonsense. I had just been promoted
to a managerial role and regretted it after a week. After so much time hoping
for a promotion, I immediately wanted to go back to the technical side. I became
obsessed with learning new stuff again, particularly in the high performance
space.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="taking-the-plunge"></a>Taking the plunge<a aria-hidden="true" tabindex="-1" class="hash-link" href="#taking-the-plunge" title="Direct link to heading">#</a></h2><p>With some money aside, I left my job and started to work on QuestDB solo. I used
Java and a small C layer to interact directly with the OS API without passing
through a selector API. Although existing OS API wrappers would have been easier
to get started with, the overhead increases complexity and hurts performance. I
also wanted the system to be completely GC-free. To do this, I had to build
off-heap memory management myself and I could not use off-the-shelf libraries. I
had to rewrite many of the standard ones over the years to avoid producing any
garbage.</p><p>As I had my first kid, I had to take contracting gigs to make ends meet over the
following 6 years. All the stuff I had been learning boosted my confidence and I
started performing well at interviews. This allowed me to get better paying
contracts, I could take fewer jobs and free up more time to work on QuestDB
while looking after my family. I would do research during the day and implement
this into QuestDB at night. I was constantly looking for the next thing, which
would take performance closer to the limits of the hardware.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="back-to-the-drawing-board"></a>Back to the drawing board<a aria-hidden="true" tabindex="-1" class="hash-link" href="#back-to-the-drawing-board" title="Direct link to heading">#</a></h2><p>A year in, I realised that my initial design was actually flawed and that it had
to be thrown away. It had no concept of separation between readers and writers
and would thus allow dirty reads. Storage was not guaranteed to be contiguous,
and pages could be of various non-64-bit-divisible sizes. It was also very much
cache-unfriendly, forcing the use of slow row-based reads instead of fast
columnar and vectorized ones. Commits were slow, and as individual column files
could be committed independently, they left the data open to corruption.</p><p>Although this was a setback, I got back to work. I wrote the new engine to allow
atomic and durable multi-column commits, provide repeatable read isolation, and
for commits to be instantaneous. To do this, I separated transaction files from
the data files. This made it possible to commit multiple columns simultaneously
as a simple update of the last committed row id. I also made storage dense by
removing overlapping memory pages and writing data byte by byte over page edges.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="its-getting-real"></a>It&#x27;s getting real!<a aria-hidden="true" tabindex="-1" class="hash-link" href="#its-getting-real" title="Direct link to heading">#</a></h2><p>This new approach improved query performance. It made it easy to split data
across worker threads and to optimise the CPU pipeline with prefetch. It
unlocked column-based execution and additional virtual parallelism with
<a href="https://news.ycombinator.com/item?id=22803504" target="_blank" rel="noopener noreferrer">SIMD instruction sets</a> thanks to
<a href="https://www.agner.org/optimize/vectorclass.pdf" target="_blank" rel="noopener noreferrer">Agner Fog’s Vector Class Library</a>.
It made it possible to implement more recent innovations like our
<a href="https://github.com/questdb/questdb/blob/master/core/src/main/c/share/rosti.h" target="_blank" rel="noopener noreferrer">own version of Google SwissTable</a>.
I published more details when we released a demo server a few weeks ago on
<a href="https://news.ycombinator.com/item?id=23616878" target="_blank" rel="noopener noreferrer">ShowHN</a>. This
<a href="http://try.questdb.io:9000/" target="_blank" rel="noopener noreferrer">demo</a> is still available to try online with a
pre-loaded dataset of 1.6 billion rows. Although it was hard and discouraging at
first, this rewrite turned out to be the second best thing that happened to
QuestDB.</p><p>The best thing was that people started to contribute to the project. I am really
humbled that Tanc and Nic left our previous employer to build QuestDB. A few
months later, former colleagues of mine left their stable low-latency jobs at
banks to join us. I take this as a huge responsibility and I don’t want to let
these guys down. The amount of work ahead gives me headaches and goosebumps at
the same time.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/hackernews">hackernews</a><a class="margin-horiz--sm" href="/blog/tags/story">story</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/08/19/memory-mapping-deep-dive"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Re-examining our approach to memory mapping</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/07/24/use-questdb-for-swag"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Use QuestDB and get swag! »</div></a></div></nav></div></div><div class="col col--2"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-setup" class="table-of-contents__link">The setup</a></li><li><a href="#taking-the-plunge" class="table-of-contents__link">Taking the plunge</a></li><li><a href="#back-to-the-drawing-board" class="table-of-contents__link">Back to the drawing board</a></li><li><a href="#its-getting-real" class="table-of-contents__link">It&#39;s getting real!</a></li></ul></div></div></div></div></div><footer class="footer_mib0 section_3Kiu"><div class="footer__inner_z0Le section--inner_2xOo"><div class="footer__column_3Npq footer__column--left_1EuR"><img alt="QuestDB logo" class="footer__logo_29Wo" src="/img/footer/questdb.svg" title="QuestDB - Fastest open source database for time series and analytics"><p class="footer__tagline_2F15">QuestDB is the fastest open source time series database</p><a class="footer__github_8UHO button_Ni2_ button--icon_3YKU button--secondary_1x2U button--xsmall_3jz_" href="https://github.com/questdb/questdb" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_3Npq footer__column--right_1XPX"><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">QuestDB</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/docs/introduction/">Documentation</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/questdb/questdb/projects/3" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/careers/">Careers</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">Community</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://slack.https://fsharechat.github.io/" rel="noopener noreferrer" target="_blank">Slack</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://twitter.com/questdb" rel="noopener noreferrer" target="_blank">Twitter</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">More</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/blog/">Blog</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/questdb/questdb" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></div></div></div><div class="footer__bottom_2RpL"><p class="footer__copyright_1o2i">Copyright © 2020 QuestDB</p></div></footer></div>
<script src="/styles.c1a63971.js" defer="defer"></script>
<script src="/main.6f3bf291.js" defer="defer"></script>
<script src="/common.3d2125a2.js" defer="defer"></script>
<script src="/ccc49370.e8c9b56c.js" defer="defer"></script>
<script src="/b8e52fe3.030b8847.js" defer="defer"></script>
</body>
</html>